@model GamesPlatform.DTOs.UserDetailsDTO

@{
    ViewData["Title"] = "User details - " + (Model?.UserName ?? "User");
    var libGames = Model.LibGames ?? Enumerable.Empty<GamesPlatform.Models.LibGame>();
    var reviews = Model.Reviews ?? Enumerable.Empty<GamesPlatform.Models.Review>();
    var ratings = Model.Ratings ?? Enumerable.Empty<GamesPlatform.Models.Rating>();
    var libGameIds = new HashSet<int>(libGames.Select(l => l.GameId));
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>@Model.UserName</h1>
    </div>

    <section class="mb-5">
        <h3>Library (@libGames.Count())</h3>

        @if (libGames.Any())
        {
            <div class="row">
                @foreach (var lg in libGames)
                {
                    var g = lg.Game;
                    var userRating = ratings.FirstOrDefault(rt => rt.GameId == lg.GameId);

                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            @if (!string.IsNullOrEmpty(g?.ThumbNailUrl))
                            {
                                <a asp-controller="Games" asp-action="Game" asp-route-id="@lg.GameId">
                                    <img src="@g.ThumbNailUrl" class="card-img-top" alt="@g?.Title" style="object-fit:cover; height:180px;" />
                                </a>
                            }
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    <a asp-controller="Games" asp-action="Game" asp-route-id="@lg.GameId" class="stretched-link text-decoration-none">
                                        @(g?.Title ?? $"GameId: {lg.GameId}")
                                    </a>
                                </h5>
                                <p class="mb-1 text-muted">Status: @lg.Status</p>

                                @if (userRating != null)
                                {
                                    <div class="mb-2">
                                        <strong>Ocena użytkownika:</strong>
                                        <span class="badge bg-info text-dark ms-2">G: @userRating.Gameplay</span>
                                        <span class="badge bg-info text-dark ms-1">Gr: @userRating.Graphics</span>
                                        <span class="badge bg-info text-dark ms-1">O: @userRating.Optimization</span>
                                        <span class="badge bg-info text-dark ms-1">S: @userRating.Story</span>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-muted">Brak gier w bibliotece.</p>
        }
    </section>

    <hr />

    <section class="mb-5">
        <h3>Reviews & Ratings</h3>

        @if (!reviews.Any())
        {
            <p class="text-muted">Brak recenzji.</p>
        }
        else
        {
            <div class="row">
                @foreach (var review in reviews)
                {
                    var rGame = review.Game;
                    var rRating = ratings.FirstOrDefault(rt => rt.GameId == review.GameId);

                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-1">
                                    <a asp-controller="Games" asp-action="Game" asp-route-id="@review.GameId" class="stretched-link text-decoration-none">
                                        @(rGame?.Title ?? $"GameId: {review.GameId}")
                                    </a>
                                </h5>
                                <small class="text-muted">By: @(review.User?.UserName ?? review.UserId)</small>

                                @if (rRating != null)
                                {
                                    <div class="mt-2">
                                        <strong>Rating:</strong>
                                        <span class="badge bg-info text-dark ms-2">G: @rRating.Gameplay</span>
                                        <span class="badge bg-info text-dark ms-1">Gr: @rRating.Graphics</span>
                                        <span class="badge bg-info text-dark ms-1">O: @rRating.Optimization</span>
                                        <span class="badge bg-info text-dark ms-1">S: @rRating.Story</span>
                                    </div>
                                }

                                <p class="card-text mt-3 text-truncate" title="@review.Description">@review.Description</p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </section>
</div>
